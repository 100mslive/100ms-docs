---
title: Preview
nav: 3.08
---

The preview screen is a frequently used UX element that allows users to check if their input devices are working properly and set the initial state (mute/unmute) of their audio and video tracks before joining. 

100ms SDKs provide an easy-to-use API to back this feature. Additionally, the SDK will try to establish a connection to 100ms server to verify there are no network issues and that the auth credentials are valid so that if everything is in order the subsequent room join will be much faster.

Create an object of the HMSConfig class using the available join configurations

```dart
HMSConfig config = HMSConfig(authToken: token,userName: user);
```

To invoke the Preview API call -

```dart
HMSSDK hmsSDK = HMSSDK();
hmsSDK.build();
//config which we created above
hmsSDK.preview(config);
```

Now once we started previewing we need to listen to the updates. You get this via `HMSPreviewListener`.

The methods of HMSPreviewListener are invoked to notify updates while in preview like a peer join, video mute/unmute, audio device selection etc.

To listen to `HMSPreviewListener` methods we will need to attach a preview listener on hmsSDK.
Let's look at how we can listen to preview updates in the room:

1. Firstly, the class where we want the updates must implement `HMSPreviewListener`:

```dart 
class PreviewUpdates implements HMSPreviewListener{}
```

2. To start getting updates we will attach the previewListener as:

```dart
//hmsPreviewListener is an instance of HMSPreviewListener
//hmsSDK is HMSSDK instance on which the build is already called above

hmsSDK.addPreviewListener(listener: hmsPreviewListener);
```

3. We need to override `HMSPreviewListener` methods as: 

```dart
class PreviewUpdates implements HMSPreviewListener{

  @override
  void onHMSError({required HMSException error}){}

  @override
  void onPreview({required HMSRoom room, required List<HMSTrack> localTracks}){}

  @override
  void onRoomUpdate({required HMSRoom room, required HMSRoomUpdate update}){}

  @override
  void onPeerUpdate({required HMSPeer peer, required HMSPeerUpdate update}){}

  @override
  void onAudioDeviceChanged(
      {HMSAudioDevice? currentAudioDevice,
      List<HMSAudioDevice>? availableAudioDevice}){}
}
```

After calling preview your app will be provided an update from the 100ms SDK.

✅ If successful, the `onPreview({required HMSRoom room, required List<HMSTrack> localTracks})` method of HMSPreviewListener will be invoked with information about the room encapsulated in the HMSRoom object.

❌ If failure, the `onHMSError({required HMSException error})` method will be invoked with exact failure reason.

4. Render Preview 

In case of success `onPreview` provides an array of local tracks in the parameter `localTracks` that you can display to the user (see [Render Video](render-video) and [Mute](mute) sections for more details).

- Fetching the track in `onPreview` callback:

```dart
@override

List<HMSVideoTrack> videoTracks = [];
void onPreview({required HMSRoom room, required List<HMSTrack> localTracks}) {

   for (var track in localTracks) {
      if (track.kind == HMSTrackKind.kHMSTrackKindVideo) {
        isVideoOn = !(track.isMute);
        videoTracks.add(track as HMSVideoTrack);
      }
      if (track.kind == HMSTrackKind.kHMSTrackKindAudio) {
        isAudioOn = !(track.isMute);
      }
   }
} 
```

- Display the track using `HMSVideoView`:

```dart 
//videoTracks is the List<HMSVideoTrack> which we have set above
HMSVideoView(
   scaleType:
         ScaleType.SCALE_ASPECT_FILL,
   track:videoTracks[0],//setting the first track from videoTracks list to render on screen
   setMirror: true,
   matchParent: false,
)
```

Check how we have implemented the preview in our sample app [here](https://github.com/100mslive/100ms-flutter/tree/main/example/lib/preview)

5. To stop receiving preview updates or if we navigating from preview then we can remove the `previewListener` instance as:

```dart
hmsSDK.removePreviewListener(previewListener);
```

Now, let's take a look at the listener class in detail.

```dart
///[HMSPreviewListener] listens to updates when you preview.
///
///Just implement it and get the preview updates.
///
/// Check out the [Sample App] to know about how we are implementing it: https://github.com/100mslive/100ms-flutter.

abstract class HMSPreviewListener {
  ///when an error is caught [onError] will be called
  ///
  /// - Parameters:
  ///   - error: error which you get.
  void onHMSError({required HMSException error});

  ///when you want to preview listen to this callback
  ///
  /// - Parameters:
  ///   - room: the room which was joined
  ///   - localTracks: local audio/video tracks list
  void onPreview({required HMSRoom room, required List<HMSTrack> localTracks});

  /// This is called when there is a change in any property of the Room
  ///
  /// - Parameters:
  ///   - room: the room which was joined
  ///   - update: the triggered update type. Should be used to perform different UI Actions
  void onRoomUpdate({required HMSRoom room, required HMSRoomUpdate update});

  /// This will be called whenever there is an update on an existing peer
  /// or a new peer got added/existing peer is removed.
  ///
  /// This callback can be used to keep a track of all the peers in the room
  /// - Parameters:
  ///   - peer: the peer who joined/left or was updated
  ///   - update: the triggered update type. Should be used to perform different UI Actions
  void onPeerUpdate({required HMSPeer peer, required HMSPeerUpdate update});

  ///whenever a new audio device is plugged in or audio output is changed we
  ///get the onAudioDeviceChanged update
  ///This callback is only fired on Android devices. On iOS, this callback will not be triggered.
  /// - Parameters:
  ///   - currentAudioDevice: Current audio output route
  ///   - availableAudioDevice: List of available audio output devices
  void onAudioDeviceChanged(
      {HMSAudioDevice? currentAudioDevice,
      List<HMSAudioDevice>? availableAudioDevice});
}

```


## Get onPeerUpdate and room state in preview 

To enable `onPeerUpdate` in the preview, we need to enable room state from the dashboard.
This can be enabled by selecting a template and then navigating to advanced settings.

![Advanced settings](/docs/v2/flutter-advanced-settings.png)

These options are available in advanced settings:

![Room State in preview](/docs/v2/flutter-room-state-in-preview.png)
