---
title: Background Handling
nav: 3.28
---

While a user has joined a 100ms Room they can put the app in Background Mode & usually expect a certain subset of app functionality continues to work. 

Background Mode implies that the application is not currently visible to the user, not responding to user input, and running in the Background. 

Background state in Flutter apps is represented by `AppLifecycleState.paused` as described [here](https://api.flutter.dev/flutter/dart-ui/AppLifecycleState.html#paused).

Android & iOS have different mechanisms of handling app behaviour which includes limiting access to Camera & Microphone, time allowed to keep running before getting  completely stopped, Aggressive Battery Optimisations on Android OEMs, etc.

There are 2 prominent behaviours that are mainly affected when apps transition to Background State - Publishing Audio/Video, and Playing incoming Audio/Video.

### Android Behaviours when the app goes to the background without enabling background processing

| **Scenario**   | **Behaviours**                                 |
| :------------- | :----------------------------------------------------- |
| Mic is unmuted | Mic will remain unmuted and the user will able to publish audio for a limited period (time depending on OS) |
| Camera is unmuted | Camera will remain unmuted and the user will able to publish video for a limited period (time depending on OS)  |
| Remote Peer is publishing audio | Able to play incoming audio from the room |

### Android Behaviours when the app goes to the background with enabling background processing

| **Scenario**   | **Behaviours**                                 |
| :------------- | :----------------------------------------------------- |
| Mic is unmuted | Mic will remain unmuted and the user will able to publish audio without any restriction |
| Camera is unmuted | Camera will remain unmuted and the user will able to publish video without any restriction |
| Remote Peer is publishing audio | Able to play incoming audio from the room |

### iOS Behaviours when the app goes to the background without enabling background processing

| **Scenario**   | **Behaviours**                                 |
| :------------- | :----------------------------------------------------- |
| Mic is unmuted | Mic will get muted |
| Camera is unmuted | Camera will get muted |
| Remote Peer is publishing audio | Able to play incoming audio from the room |

### iOS Behaviours when the app goes to the background with enabling background processing

| **Scenario**   | **Behaviours**                                 |
| :------------- | :----------------------------------------------------- |
| Mic is unmuted |Mic will remain unmuted and the user will able to publish audio without any restriction  |
| Camera is unmuted | Camera will get muted |
| Remote Peer is publishing audio | Able to play incoming audio from the room |


Let's breakdown how your apps can implement efficient handling of Background states on Android & iOS Platforms.

## Android

To keep the app running in the background even after the device goes into sleep mode then we need to add background permission in the app for android and iOS both.

In Android, if you want to speak in sleep mode then Android OS allow it for around 60 seconds (depend on OS) by default but if you want to continue it for more than allowed time then we have to use 3 party plugin [flutter_foreground_task](https://pub.dev/packages/flutter_foreground_task) which allows the app to run in the foreground with a notification.

Here is step by step guide how to integrate flutter_foreground_task in application for 100ms SDK.

> Note: Playing Audio works fine without using Foreground Service as well.

<div className="steps-container">

### Add plugin
Add `flutter_foreground_task` as a dependency in your `pubspec.yaml` file.
```
dependencies:
  flutter_foreground_task: "3.10.0"
```

### Adding Service in `AndroidManifest.xml`

Add service inside `<application>` tag as follows:
```
<application>
    ...
     <activity>
        ...
     </activity>

<service android:name="com.pravera.flutter_foreground_task.service.ForegroundService" 
  android:foregroundServiceType="camera|microphone" />

</application>
```

### Start Foreground Service
Wrap meeting page with `WillStartForegroundTask` widget as follows:
```dart
@override
Widget build(BuildContext context) {
  return MaterialApp(
    // A widget to start the foreground service when the app is minimized or closed.
    // This widget must be declared above the [Scaffold] widget.
    home: WillStartForegroundTask(
      onWillStart: () async {
        // Return whether to start the foreground service.
        return true;
      },
      androidNotificationOptions: AndroidNotificationOptions(
        channelId: 'notification_channel_id',
        channelName: 'Foreground Notification',
        channelDescription: 'This notification appears when the foreground service is running.',
        channelImportance: NotificationChannelImportance.LOW,
        priority: NotificationPriority.LOW,
        iconData: NotificationIconData(
          resType: ResourceType.mipmap,
          resPrefix: ResourcePrefix.ic,
          name: 'launcher',
        ),
      ),
      iosNotificationOptions: const IOSNotificationOptions(
        showNotification: false,
        playSound: false,
      ),
      foregroundTaskOptions: const ForegroundTaskOptions(
        interval: 5000,
        autoRunOnBoot: false,
        allowWifiLock: false,
      ),
      notificationTitle: 'Foreground Service is running',
      notificationText: 'Tap to return to the app',
      callback: startCallback,
      child: Scaffold(
        appBar: AppBar(
          title: const Text('Your App Title'),
          centerTitle: true,
        ),
        body: MeetingApp(),
      ),
    ),
  );
}
```
</div>

> To know more about `flutter_foreground_task` visit [here](https://pub.dev/packages/flutter_foreground_task) or checkout implementation in our [example app](https://github.com/100mslive/100ms-flutter/tree/main/example).

## iOS

When your app goes into the background, it can no longer access camera and publish it to other peers in the room. Also, you can't see video of other participants in the call if your app is in the background.

Follow the following step to add background service in iOS:

<div className="steps-container">

### Open project in Xcode

Open project in Xcode by right clicking on `ios` folder in project and select `Open in Xcode` as shown in image below.

![OpenXcode](/docs/v2/flutter-background-service-1.png)

### Add Capability

Click on `Runner` in Navigator then select `Runner` under `TARGETS` and click on `Signing & Capabilities` and add `Capability`.

![addCapability](/docs/v2/flutter-background-service-2.png)

### Background Mode

Search background mode and add it to project by clicking on it.

![backgroundMode](/docs/v2/flutter-background-service-3.png)

### Start Background Processing

Check the checkbox under background mode named ` Background Processing` and `Audio, AirPlay, and Picture in Picture`.

![backgroundProcessing](/docs/v2/flutter-background-service-4.png)

</div>

Now you can use your app in the background even when the device is in sleep mode.