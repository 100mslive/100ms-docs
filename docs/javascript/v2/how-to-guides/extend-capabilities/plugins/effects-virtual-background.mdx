---
title: Virtual Background with Effects SDK
nav: 1.45
---

<Note type="warning">
    This feature is still in Beta. To know more or report any issues, feel free to reach out to us
    over <a href={'https://discord.com/invite/kGdmszyzq2'}>Discord</a>.
</Note>


## Pre-requisites

**Get the 100ms VirtualBackground Package**

```bash section=GetHMSVirtualBackgroundPackage sectionIndex=1
npm install --save @100mslive/hms-virtual-background@latest
```

## Features

The following features are currently supported under the `HMSEffectsPlugin` class:

```js
setBlur(blurPower: number)
// The blur intensity is determined by the blurPower, which can range from 0 to 1

setBackground(mediaURL: string)
// Accepts the media URL to set as the virtual background

getName()
// returns 'HMSEffects', can be used to check if the plugin has been initialised

getBackground()
/* 
  Returns the background type currently enabled or the media URL.
  Represented by the HMSVirtualBackgroundTypes enum which is present in 
  @100mslive/hms-virtual-background. Useful to show active selection in the UI. 
*/

removeEffects()
// Clears all applied filters

stop()
// Stops the plugin
```



## Instantiate Virtual Background

The SDK key for effects is needed to instantiate the `HMSEffectsPlugin` class:

```jsx
  const effectsKey = useHMSStore(selectEffectsKey);
```

It is recommended to initialise the object in a separate file to prevent multiple initialisations on re-renders and keep the UI level code independent of internal calls by the SDK.


```js
import { HMSEffectsPlugin, HMSVirtualBackgroundTypes } from '@100mslive/hms-virtual-background';

export class VBPlugin {
  private effectsPlugin?: HMSEffectsPlugin | undefined;

  initialisePlugin = (effectsSDKKey?: string) => {
    if (this.getVBObject()) {
      return;
    }
    if (effectsSDKKey) {
      this.effectsPlugin = new HMSEffectsPlugin(effectsSDKKey);
    }
  };

  getBackground = () => {
    return this.effectsPlugin?.getBackground();
  };

  getBlurAmount = () => {
    return this.effectsPlugin?.getBlurAmount();
  };

  getVBObject = () => {
    return this.effectsPlugin;
  };

  getName = () => {
    return this.effectsPlugin?.getName();
  };

  setBlur = async (blurPower: number) => {
    this.effectsPlugin?.setBlur(blurPower);
  };

  setBackground = async (mediaURL: string) => {
    this.effectsPlugin?.setBackground(mediaURL);
  };

  // Can be used to set the quality of VB. The default is "balanced"
  // Options: "lightning" | "speed" | "balanced" | "quality"
  // The quality of the VB and CPU usage increases from left to right
  setPreset = (preset: string) => {
    this.effectsPlugin.setPreset(preset);
  };

  getPreset = () => {
    return this.effectsPlugin?.getPreset() || '';
  };

  removeEffects = async () => {
    this.effectsPlugin?.removeEffects();
  };

  reset = () => {
    this.effectsPlugin = undefined;
  };
}

export const VBHandler = new VBPlugin();

```

## Building the UI

The following snippet illustrates how to add the plugin to the video and manage the UI state to preserve configuration:

```jsx

import {
  selectLocalVideoTrackID,
  selectEffectsKey,
  useHMSStore,
} from '@100mslive/react-sdk';
import { 
  HMSEffectsPlugin, 
  HMSVirtualBackgroundTypes
  } from '@100mslive/hms-virtual-background';
import { VBHandler } from './VBHandler';

export const VirtualBackgroundPicker = () => {
    const hmsActions = useHMSActions();
    // Get the effects SDK key here
    const effectsKey = useHMSStore(selectEffectsKey);
    const trackId = useHMSStore(selectLocalVideoTrackID);
    
    // State can be used to show active selection
    const [background, setBackground] = useState<string | HMSVirtualBackgroundTypes>(
        VBHandler.getBackground() as string | HMSVirtualBackgroundTypes,
    );

	useEffect(() => {
        if (!track?.id) {
            return;
        }
        if (!isPluginAdded) {
            let vbObject = VBHandler.getVBObject();
            if (!vbObject) {
                VBHandler.initialisePlugin(effectsKey);
                vbObject = VBHandler.getVBObject();
                if (effectsKey) {
                hmsActions.addPluginsToVideoStream([vbObject as HMSEffectsPlugin]);
                } 
            }
        }
    }, [hmsActions, isPluginAdded, effectsKey, track?.id]);

  // UI code for media picker can go here
}
```

This handles initialisation and adding the plugin to the video stream. The plugin takes a few seconds on first load during initialisation. Subsequent filter and effect selections should take less than a second to reflect.

The methods can be called via the `VBHandler` object:
```jsx

const setBackground = async(mediaURL : string) => {
  await VBHandler?.setBackground(mediaURL);
  // The selection can be highlighted using the activeBackground state
  setActiveBackground(mediaURL);
}

const setBlur = async(blurAmount: number) => {
  await VBHandler?.setBlur(blurAmount);
  setActiveBackground(HMSVirtualBackgroundTypes.BLUR);
}

const removeEffects = async() => {
  await VBHandler.removeEffects();
  setActiveBackground(HMSVirtualBackgroundTypes.NONE);
}

```


The full implementation can be viewed in the [roomkit-react package](https://github.com/100mslive/web-sdks/blob/main/packages/roomkit-react/src/Prebuilt/components/VirtualBackground/VBPicker.tsx).


## Supported Browsers

Effects virtual background is supported on Safari, Firefox and Chromium based browsers.<br/>
