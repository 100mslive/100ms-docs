---
 title: HLS Timed Metadata
 nav: 8.05
---

HLS Timed Metadata feature helps you synchronise certain events with the HLS stream. This can be useful for showing interactive quizzes / product overlays etc.

## Requirements

- 100ms Android SDK version 2.5.6 or higher
- Active HLS stream

## Sending HLS Timed Metadata

To add HLS timed metadata cue to the currently running HLS stream use `setHlsSessionMetadata` API like this:

<Tabs id="send-hmsTimedMetadata" items={['Kotlin', 'Java']} />

<Tab id='send-hmsTimedMetadata-0'>

```kotlin
val metadata = HMSHLSTimedMetadata(
                        payload  = payloadText,
                        duration = durationText
                    )

hmsSDK.setHlsSessionMetadata(arrayListOf(hmsHLSTimedMetadata), object : HMSActionResultListener {
        override fun onError(error: HMSException) {
            Log.d(TAG, "Unable to send metadata")
        }

        override fun onSuccess() {
           Log.d(TAG, "hls metadata sent")
        }
})
```

</Tab>

<Tab id='send-hmsTimedMetadata-1'>

```java

HMSHLSTimedMetadata metaDataModel = new HMSHLSTimedMetadata(payload,duration,metaData);
ArrayList<HMSHLSTimedMetadata> metadataModelList = new ArrayList<HMSHLSTimedMetadata>(metaDataModel);
metadataModelList.add(metaDataModel);
hmsSDK.setHlsSessionMetadata(metadataModelList, new HMSActionResultListener() {
    @Override
    public void onSuccess() {
        Log.d(TAG, "hls metadata sent successfully");
    }

    @Override
    public void onError(@NonNull HMSException e) {
        Log.d(TAG, "hls metadata sending failed");
    }
});

```
</Tab>

## Receiving HLS Timed Metadata

1. Getting the metadata from exoplayer : 

<Tabs id="recieve-hmsTimedMetadata" items={['Kotlin', 'Java']} />

<Tab id='recieve-hmsTimedMetadata-0'>
```kotlin

        val hlsManifest = exoPlayer.currentManifest as HlsManifest?
        val windowIndex = exoPlayer.currentMediaItemIndex
        val timeline = exoPlayer.currentTimeline
        val window = timeline.getWindow(windowIndex, Timeline.Window())
        val currentAbsolutePosition = (window.windowStartTimeMs + exoPlayer.currentPosition)
        val META_DATA_MATCHER = "#EXT-X-DATERANGE:ID=\"(?<id>.*)\",START-DATE=\"(?<startDate>.*)\",DURATION=(?<duration>.*),X-100MSLIVE-PAYLOAD=\"(?<payload>.*)\""
        
        hlsManifest?.mediaPlaylist?.tags?.lastOrNull {
            if (it.contains("EXT-X-DATERANGE")) {
                val pattern = Pattern.compile(META_DATA_MATCHER)
                val matcher = pattern.matcher(it)
                if (matcher.matches()) {
                    try {
                        val payload = matcher.group(4).orEmpty()
                        val duration = matcher.group(3).orEmpty().toLongOrNull()?.times(1000) ?: 0
                        val startDate = matcher.group(2).orEmpty()
                        val formatter = SimpleDateFormat("yyyy-MM-dd'T'HH:mm:ss.SSS'Z'")
                        formatter.timeZone = UTC
                        val tagStartTime = formatter.parse(startDate).time
                        lastFoundTag = LocalMetaDataModel(payload, duration)
                        lastFoundTag?.startTime = tagStartTime
                        return@lastOrNull tagStartTime <= currentAbsolutePosition
                    } catch (e: Exception) {
                    }
                }
            }
            false
        }

```
</Tab>

<Tab id='recieve-hmsTimedMetadata-1'>

```java 

        HlsManifest hlsManifest = (HlsManifest) exoPlayer.getCurrentManifest();
        int windowIndex = exoPlayer.getCurrentMediaItemIndex();
        Timeline timeline = exoPlayer.getCurrentTimeline();
        Timeline.Window window = timeline.getWindow(windowIndex, new Timeline.Window());
        long currentAbsolutePosition = (window.windowStartTimeMs + exoPlayer.getCurrentPosition());
        String META_DATA_MATCHER = "#EXT-X-DATERANGE:ID=\"(?<id>.*)\",START-DATE=\"(?<startDate>.*)\",DURATION=(?<duration>.*),X-100MSLIVE-PAYLOAD=\"(?<payload>.*)\""

        Stream<String> tag = hlsManifest.mediaPlaylist.tags.stream().filter(new Predicate<String>() {
            @Override
            public boolean test(String tag) {
                if (tag.contains("EXT-X-DATERANGE")) {
                    Pattern pattern = Pattern.compile(META_DATA_MATCHER);
                    Matcher matcher = pattern.matcher(tag);
                    if (matcher.matches()) {
                        try {
                            String payload = matcher.group(4);
                            long duration = Long.getLong(Objects.requireNonNull(matcher.group(3))) * (1000);
                            String startDate = matcher.group(2);
                            SimpleDateFormat formatter = new SimpleDateFormat("yyyy-MM-dd'T'HH:mm:ss.SSS'Z'");
                            formatter.setTimeZone(TimeZone.getTimeZone("UTC"));
                            long tagStartTime = formatter.parse(startDate).getTime();
                            LocalMetaDataModel lastFoundTag = new LocalMetaDataModel(payload, duration);
                            lastFoundTag.setStartTime(tagStartTime);
                            return tagStartTime <= currentAbsolutePosition;
                        } catch (Exception e) {
                            e.printStackTrace();
                        }
                    }
                }
               return false;
            }
        });

```
</Tab>

2. Syncing up last found tag from above getter with current player position.

<Tabs id="sync-hmsTimedMetadata" items={['Kotlin', 'Java']} />

<Tab id='sync-hmsTimedMetadata-0'>
```kotlin 

    lastFoundTag?.let { tag ->
        val tagStartTime = tag.startTime
        if (tagStartTime <= currentAbsolutePosition && currentAbsolutePosition - tagStartTime <= tag.duration) {
            // you can modify this toast message , as per requirement
            Toast.makeText(context, "Metadata Found", Toast.LENGTH_SHORT).show()
        }
    }

```
</Tab>

<Tab id='sync-hmsTimedMetadata-1'>
```java 

    if (lastFoundTag != null){
        long tagStartTime = lastFoundTag.getStartTime();
        if (tagStartTime <= currentAbsolutePosition && currentAbsolutePosition - tagStartTime <= lastFoundTag.getDuration()) {
            // you can modify this toast message , as per requirement
            Toast.makeText(context, "Metadata Found", Toast.LENGTH_SHORT).show();
        }
    }

```
</Tab>


